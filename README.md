![Workflow Badge](https://github.com/ipnate/tic-tac-toe/actions/workflows/build-test-deploy.yml/badge.svg)

# Tic Tac Toe

## Description

This is a basic Tic Tac Toe game create in HTML, CSS, and JavaScript. The JavaScript makes use of `ES6 Modules` instead of CommonJS for a more modern approach. It implements Webpack to build the application for deployment as well as to server the application with hot loading in development.

It makes use of `Node.js v16.20.2`, `webpack@5 (+ supporting packages)` and `pnpm@8` for development, `vitest@0.34.6` for unit-tests and `playwright@1.43.1` for end-to-end tests.

Include in the repository is a `.nvmrc` with the required Node.js version, a `package.json` file with the required packages and a `pnpm-lock.yaml` instead of a package-lock.json as we are using `pnpm`.

There are no CSS Frameworks or Frontend JavaScript Frameworks implemented.

## Configuration

#### Webkit
Webkit is configure to by default produce a production build when the build command is run, this can be changed by updating`mode: production` to `mode: development` in the `webpack.config.js` file.

The build is generated by bundling all the javascript into a `bundle.js` file that is then injected into the end of the `body` tag in the index.html file. It also injects all the CSS and the favicon into the index.html on build.

This is all configured in the `webpack.config.js` file and can be adjust as need be. There is no need to reference any links, styles or scripts directly in the index.html file as webpack uses it as a template and inject all the needed dependencies on build time.

The webpack dev server does the same with the notable differnce that it offers hot loading and doesn't do a production build i.e. the files aren't minified.

#### Vitest

Vitest uses a mostly default configuration which allows for access to globals such as `document` and implements `jsdom` as the environment if any direct dom minipulation needs to be tested.

There isn't a directory specified that contains the vitest test, the command specified under the `Unit Tess` section directly references the file to be run. If there is need to add any more test files, the `vitest.config.js` file can be adapted.

#### Playwright

Playwright in configured to run in `headless` mode by default. There are 3 projects defined in the `playwright.config.js` file to run the tests in either `Chromium`,`Firefox`, or `Webkit` browser engines.

In development mode the output of the test are written to the console in a list format. In the Github Actions CI pipline it is configured to output a HTML file for each browser with the results and store it in an artifact.

## Installation

#### Dependencies that should be preinstalled.
```
NVM (Node Version Manager)
Node v16.20.2
```

This project uses [pnpm](https://pnpm.io/). Go check them out if you don't have them locally installed.

```bash
$ npm install -g pnpm@8
$ pnpm install
```

## Usage

```bash
$ pnpm start
```

This will start the webpack dev server at `localhost:8080`.

## Build

```bash
$ pnpm run build
```

This will create a production-ready `index.html` and `bundle.js` in the `dist` directory.

## Testing

#### Unit tests (vitest)

```bash
$ pnpm test:vi:run
```

This will run the vitest unit tests.

#### End to end testing (Playwright)
You first need to install the Playwright browsers and dependencies before you can run the tests.
```bash
$ pnpm test:pw:ci
```

Then you need to build the project.
```bash
$ pnpm run build
```

If these steps have completed you can now run the tests.
```bash
$ pnpm test:pw:run:all #This will run the tests in headless mode for chromium, firefox, and webkit
$ pnpm test:pw:run:chromium #This will run the tests in headless mode for just chromium.
$ pnpm test:pw:run:firefox #This will run the tests in headless mode for just firefox.
$ pnpm test:pw:run:webkit #This will run the tests in headless mode for just webkit.
```
If there is a need to see the test running in headed mode you can add the `--headed` flag.

## Contributing

Pull requests are welcome. The default branch is master, it is a protected branch. You can branch of it and submit a Pull Request.

If you create a Pull Request the CI Pipline will kick off the Github Actions Workflow and run the Build, Unit Tests and End to end tests. All these test are required to pass before being able to merge into master.

A contributor also needs to approve your changes before it can be merged into master.

After the pull request is merged to master the CI/CD Pipline will kick off again and complete the entire workflow which consists off running the Build, Unit Tests, End to end tests and deploying the build to github pages under http://ipnate.github.io/tic-tac-toe.

## Build Pipline

The project makes use of Github Actions for its CI/CD pipline.

There are 4 shared workflows that combine into a build, test and deploy workflow. They all run on `Ubuntu` workers with `Node v16`

Retention for all artifacts are set to 7 days.

#### Build
- Installs `pnpm@8`.
- Installs all the dependencies using `pnpm@8`.
- Caches all the dependencies.
- Install all the `Playwright` browsers.
- Caches all the `Playwright` browsers.
- Builds the production build using `Webpack`.
- Uploads the build artifact to be used later.
- Uploads the build artifact to be deployed to `Github Pages` later.

#### Unit Tests
- Installs `pnpm@8`
- Checks the cache for the dependencies.
- If it couldn't find a cache it installs the dependencies using `pnpm@8`
- Runs the `Vitest` unit tests.

#### End to End Tests
This part spins up 3 jobs, one for each of the browsers: `Chromium`, `Firefox`, and `Webkit`

- Installs `pnpm@8`
- Checks the cache for the dependencies.
- If it couldn't find a cache it installs the dependencies using `pnpm@8`
- Checks the cache for the `Playwright` browsers.
- If it couldn't find the cache, it installs the `Playwright` browsers. If it is the `Webkit` job, it always install the dependencies again because webkit requires other file system dependencies that can't be cached.
- Downloads the Build artifact created in the Build step.
- Runs the `Playwright` tests agains the Build.
- Uploads the `playwright-report` artifact for inspection by developer.

#### Deploy
- If the branch is master it will proceed.
- Configures `Github Pages`.
- Deploys the artifact that was uploaded in the build step to `Github Pages`.
- Outputs the page url.

## License

[MIT](https://choosealicense.com/licenses/mit/)